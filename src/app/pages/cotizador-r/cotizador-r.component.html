<form [formGroup]="form" class="space-y-6 p-4">    
  <!-- Moneda -->

  <!-- Barra de Acciones Responsive -->
  <div class="card bg-base-100 shadow mt-6 mb-6">
    <div class="card-body p-4">
      <!-- Título -->
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
          </svg>
          Acciones
        </h3>
        <div class="badge badge-primary badge-sm">Conectado</div>
      </div>


      <!-- Grid de botones: 2 colunmas en celu, 3 en tablet, 6 en pc -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
        
        <!-- Botón 1: Generar Documento -->
        <button 
          (click)="generar_doc()" 
          class="btn btn-primary tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Crear archivo .docx">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
          <span class="text-xs font-semibold">Generar</span>
        </button>

        <!-- Botón 2: Guardar Nueva -->
        <button 
          (click)="guardarCotizacion()" 
          class="btn btn-success tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Guardar nueva cotización">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
          </svg>
          <span class="text-xs font-semibold">Guardar</span>
        </button>

        <!-- Botón 3: Actualizar -->
        <button 
          (click)="sobreescribirCotizacion()" 
          class="btn btn-warning tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Actualizar existente">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          <span class="text-xs font-semibold">Actualizar</span>
        </button>

        <!-- Botón 4: Cargar -->
        <button 
          (click)="cargarCotizacion()" 
          class="btn btn-info tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Cargar desde nube">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
          </svg>
          <span class="text-xs font-semibold">Cargar</span>
        </button>

        <!-- Botón 5: Exportar -->
        <button 
          (click)="exportar_cotizacion()" 
          class="btn btn-accent tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Exportar archivo plantilla">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <span class="text-xs font-semibold">Exportar</span>
        </button>

        <!-- Botón 6: Importar -->
        <button 
          (click)="importar_cotizacion()" 
          class="btn btn-secondary tooltip tooltip-bottom h-auto py-3 flex-col gap-1" 
          data-tip="Importar archivo plantilla">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3v-6" />
          </svg>
          <span class="text-xs font-semibold">Importar</span>
        </button>

      </div>

      <!-- Divider -->
      <div class="divider my-2"></div>

      <!-- Botón Limpiar centrado abajo -->
      <div class="flex justify-center">
        <button 
          (click)="limpiarFormulario()" 
          class="btn btn-error btn-wide tooltip tooltip-bottom gap-2" 
          data-tip="Borrar todo el formulario">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
          Limpiar Formulario
        </button>
      </div>

    </div>
  </div>



  <div class="form-control">
    <div class="flex items-center mb-2 gap-2">
      <label for="moneda" class="label font-medium">Moneda</label>
      <br>
      <select
        formControlName="moneda"
        id="moneda"
        class="select select-bordered w-full"
      >
        <option value="CLP">CLP</option>
        <option value="UF">UF</option>
      </select>
      <br>
      <label for="nro_cotizacion">Nº Cotización</label>
      <input formControlName="nro_cotizacion" id="nro_cotizacion" placeholder="N° Cotización" class="input input-bordered w-32 ml-4"/>
    </div>
    
  </div>

  <!-- Empresa -->
  <div class="collapse collapse-arrow bg-base-200 rounded-lg shadow">
    <input type="checkbox" />
    <div class="collapse-title text-lg font-bold">DATOS DE TU EMPRESA</div>
    <div class="collapse-content space-y-3">
      <div class="form-control">
        <label for="nombre_empresa" class="label">Nombre Empresa</label>
        <input
          formControlName="nombre_empresa"
          id="nombre_empresa"
          placeholder="Nombre Empresa"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="logo" class="label">Su Logo</label>
        <input
          type="file"
          formControlName="logo"
          id="logo"
          class="file-input file-input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="rut_empresa" class="label">RUT Empresa</label>
        <input
          formControlName="rut_empresa"
          id="rut_empresa"
          placeholder="RUT Empresa"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="telefono_empresa" class="label">Teléfono Empresa</label>
        <input
          formControlName="telefono_empresa"
          id="telefono_empresa"
          placeholder="Teléfono Empresa"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="email_empresa" class="label">Email Empresa</label>
        <input
          formControlName="email_empresa"
          id="email_empresa"
          placeholder="Email Empresa"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="direccion_empresa" class="label">Dirección Empresa</label>
        <input
          formControlName="direccion_empresa"
          id="direccion_empresa"
          placeholder="Dirección Empresa"
          class="input input-bordered w-full"
        />
      </div>
    </div>
  </div>

  <!-- Cliente -->
  <div class="collapse collapse-arrow bg-base-200 rounded-lg shadow">
    <input type="checkbox" />
    <div class="collapse-title text-lg font-bold">DATOS CLIENTE</div>
    <div class="collapse-content space-y-3">
      <div class="form-control">
        <label for="nombre_cliente" class="label">Nombre Cliente</label>
        <input
          formControlName="nombre_cliente"
          id="nombre_cliente"
          placeholder="Nombre Cliente"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="obra_cliente" class="label">Obra/Trabajo</label>
        <input
          formControlName="obra_cliente"
          id="obra_cliente"
          placeholder="Obra Cliente"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="contacto_cliente" class="label">Contacto Cliente</label>
        <input
          formControlName="contacto_cliente"
          id="contacto_cliente"
          placeholder="Contacto Cliente"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="email_cliente" class="label">Email Cliente</label>
        <input
          formControlName="email_cliente"
          id="email_cliente"
          placeholder="Email Cliente"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="direccion_cliente" class="label">Dirección Cliente</label>
        <input
          formControlName="direccion_cliente"
          id="direccion_cliente"
          placeholder="Dirección Cliente"
          class="input input-bordered w-full"
        />
      </div>
      <div class="form-control">
        <label for="fecha" class="label">Fecha</label>
        <input
          type="date"
          formControlName="fecha"
          id="fecha"
          class="input input-bordered w-full"
        />
      </div>
    </div>
  </div>

  <!-- Productos -->
  <div class="bg-base-200 p-4 rounded-lg shadow space-y-3">
    <h2 class="text-lg font-bold">PRODUCTOS / SERVICIOS</h2>
    <div class="flex flex-col gap-2">
      <span class="text-sm">Total de Prod. / Serv.: {{productosArray.length}}</span>
      <button
        type="button"
        (click)="addProduct()"
        class="btn btn-primary btn-sm w-fit"
      >
        Agregar
      </button>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full text-sm">
          <thead>
            <tr>
              <th>Producto/Servicio</th>
              <th>Descripción</th>
              <th>Unidad</th>
              <th>Cantidad</th>
              <th>Valor Unitario</th>
              <th>Total</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody formArrayName="productos">
            @for (control of productosArray.controls; track control; let index=$index){
              <tr [formGroupName]="index">
                <td>
                  <textarea
                    formControlName="producto"
                    class="textarea textarea-bordered textarea-sm w-full"
                  ></textarea>
                </td>
                <td>
                  <textarea
                    formControlName="descripcion"
                    class="textarea textarea-bordered textarea-sm w-full"
                  ></textarea>
                </td>
                <td>
                  <select
                    formControlName="unidad"
                    class="select select-bordered select-sm w-full"
                  >
                    <option value="" disabled>Seleccione</option>
                    <option value="na">No Aplica</option>
                    <option value="m">m</option>
                    <option value="m2">m²</option>
                    <option value="m3">m³</option>
                    <option value="cm">cm</option>
                    <option value="cm2">cm²</option>
                  </select>
                </td>
                <td>
                  <input
                    formControlName="cantidad"
                    type="number"
                    min="0"
                    class="input input-bordered input-sm w-20"
                  />
                </td>
                <td>
                  <input
                    formControlName="valorUnitario"
                    type="number"
                    min="0"
                    class="input input-bordered input-sm w-24"
                  />
                </td>
                <td>
                  {{ getTotal(index) | number:'1.0-0' }}
                </td>
                <td>
                  <button
                    type="button"
                    (click)="removeProduct(index)"
                    class="btn btn-error btn-xs"
                  >
                    Eliminar
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <!-- Resumen -->
    <h2 class="text-lg font-bold">RESUMEN</h2>
    <div class="overflow-x-auto">
      <table class="table table-compact w-full">
        <thead>
          <tr>
            <th>Subtotal</th>
            <th>IVA (19%)</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ getSubtotal() | number:'1.0-0' }}</td>
            <td>{{ getIVA() | number:'1.0-0' }}</td>
            <td>{{ getTotalCotizacion() | number:'1.0-0' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Condiciones -->
  <div class="bg-base-200 p-4 rounded-lg shadow space-y-3">
    <h2 class="text-lg font-bold">CONDICIONES</h2>
    <div class="form-control">
      <label for="validez_oferta" class="label">Validez Oferta</label>
      <input
        formControlName="validez_oferta"
        id="validez_oferta"
        placeholder="Validez Oferta"
        class="input input-bordered w-full"
      />
    </div>
    <div class="form-control">
      <label for="forma_pago" class="label">Forma de Pago</label>
      <input
        formControlName="forma_pago"
        id="forma_pago"
        placeholder="Forma de Pago"
        class="input input-bordered w-full"
      />
    </div>
    <div class="form-control">
      <label for="presupuesto_incluye" class="label">Presupuesto Incluye</label>
      <input
        formControlName="presupuesto_incluye"
        id="presupuesto_incluye"
        placeholder="Presupuesto Incluye"
        class="input input-bordered w-full"
      />
    </div>
  </div>
</form>
