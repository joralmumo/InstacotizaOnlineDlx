<div class="gestor-container">
  <div class="header">
    <h1>Gestor de Cotizaciones</h1>
    <br>
    <button class="btn btn-reload" (click)="recargarCotizaciones()" [disabled]="isLoading">
      {{ isLoading ? 'Cargando...' : 'Recargar' }}
    </button>
  </div>

  <!-- Loading state -->
  @if (isLoading) {
    <div class="loading">
      <p>Cargando cotizaciones...</p>
    </div>
  }

  <!-- Error state -->
  @if (error && !isLoading) {
    <div class="error">
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="recargarCotizaciones()">Reintentar</button>
    </div>
  }

  <!-- Empty state -->
  @if (cotizaciones.length === 0 && !isLoading && !error) {
    <div class="empty">
      <h2>No hay cotizaciones</h2>
      <p>A√∫n no has creado ninguna cotizaci√≥n.</p>
      <a href="/cotizador-r" class="btn-primary">Crear nueva cotizaci√≥n</a>
    </div>
  }

  <!-- Tablita -->
  <table class="table table-striped">
    <thead>
        <tr>
            <th>Nro. Cotizacion</th>
            <th>Cliente</th>
            <th>Obra</th>
            <th>Fecha</th>
            <th>Creada</th>
            <th>Productos</th>
            <TH>Valor</TH>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @for (cotizacion of cotizaciones; track cotizacion.nro_cotizacion) {
            <tr>
                <td>{{ cotizacion.nro_cotizacion }}</td>
                <td>{{ cotizacion.nombre_cliente }}</td>
                <td>{{ cotizacion.obra_cliente }}</td>
                <td>{{ cotizacion.fecha }}</td>
                <td>{{ cotizacion.fecha_creacion }}</td>
                <td>{{ cotizacion.productos.length }}</td>
                <td>{{ calcularTotalCotizacion(cotizacion.productos, cotizacion.moneda ?? 'CLP') }}</td>
                <td>
                  <button
                    class="btn btn-primary"
                    (click)="cargarCotizacion(cotizacion, $index)"
                    title="Cargar cotizacion"
                  >
                    Cargar Cotizaci√≥n
                  </button>
                </td>
                <td>
                    <button 
                      class="btn btn-error" 
                      (click)="eliminarCotizacion(cotizacion, $index)"
                      title="Eliminar cotizaci√≥n"
                    >
                      üóëÔ∏è
                    </button>
                </td>
            </tr>
        }
  </table>

</div>