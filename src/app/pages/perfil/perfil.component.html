<div class="perfil-container">
  <!-- Header del perfil -->
  <div class="perfil-header">
    <h1>Mi Perfil</h1>
    <p class="subtitle">Gestiona tu información personal</p>
  </div>

  <!-- Animación de carga -->
  <div *ngIf="cargando" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando información del perfil...</p>
  </div>

  <!-- Contenido principal del perfil -->
  <div *ngIf="!cargando && usuario" class="perfil-content">
    
    <!-- Tarjeta del usuario -->
    <div class="usuario-card">
      
      <!-- Avatar y info básica -->
      <div class="usuario-header">
        <div class="avatar">
          <span class="avatar-initials">{{ obtenerIniciales() }}</span>
        </div>
        <div class="usuario-info">
          <h2>{{ usuario.nombre }}</h2>
          <p class="correo">{{ usuario.correo }}</p>
          <span class="rol-badge" [class]="'rol-' + usuario.rol.toLowerCase()">
            {{ usuario.rol }}
          </span>
        </div>
        <div class="acciones-header">
          <button 
            *ngIf="!editandoPerfil" 
            class="btn btn-editar"
            (click)="iniciarEdicion()">
            <i class="icon-edit"></i>
            Editar Perfil
          </button>
        </div>
      </div>

      <!-- Información detallada -->
      <div class="usuario-detalles">
        
        <!-- Modo visualización -->
        <div *ngIf="!editandoPerfil" class="info-grid">
          <div class="info-item">
            <label>Nombre Completo</label>
            <p>{{ usuario.nombre }}</p>
          </div>
          
          <div class="info-item">
            <label>Correo Electrónico</label>
            <p>{{ usuario.correo }}</p>
          </div>
          
          <div class="info-item">
            <label>Rol</label>
            <p>{{ usuario.rol }}</p>
          </div>
          
          <div class="info-item">
            <label>Estado de la Cuenta</label>
            <p>
              <span class="estado-badge" [class]="usuario.isactive ? 'activo' : 'inactivo'">
                {{ usuario.isactive ? 'Activa' : 'Inactiva' }}
              </span>
            </p>
          </div>
          
          <div class="info-item full-width">
            <label>Cotizaciones Realizadas</label>
            <p>{{ usuario.cotizaciones.length || 0 }} cotizaciones</p>
          </div>
        </div>

        <!-- Modo edición -->
        <div *ngIf="editandoPerfil" class="edicion-form">
          <form (ngSubmit)="guardarCambios()">
            
            <div class="form-group">
              <label for="nombre">Nombre Completo</label>
              <input 
                type="text" 
                id="nombre"
                [(ngModel)]="usuarioEditado.nombre"
                name="nombre"
                class="form-control"
                required>
            </div>

            <div class="form-group">
              <label for="correo">Correo Electrónico</label>
              <input 
                type="email" 
                id="correo"
                [(ngModel)]="usuarioEditado.correo"
                name="correo"
                class="form-control"
                required>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                <i class="icon-save"></i>
                Guardar Cambios
              </button>
              <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">
                <i class="icon-cancel"></i>
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tarjeta de estadísticas -->
    <div class="estadisticas-card">
      <h3>Resumen de Actividad</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number">{{ usuario.cotizaciones.length || 0 }}</div>
          <div class="stat-label">Cotizaciones Totales</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ usuario.isactive ? 'Activa' : 'Inactiva' }}</div>
          <div class="stat-label">Estado de Cuenta</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ usuario.rol }}</div>
          <div class="stat-label">Tipo de Usuario</div>
        </div>
      </div>
    </div>

    <!-- Otras acciones -->
    <div class="acciones-card">
      <h3>Acciones de Cuenta</h3>
      <div class="acciones-list">
        <a href="/recuperar-contrasena" class="accion-item">
          <i class="icon-settings"></i>
          <div>
            <h4>Cambiar Contraseña</h4>
            <p>Actualiza tu contraseña de acceso</p>
          </div>
          <i class="icon-arrow-right"></i>
        </a>
        
        <a href="/gestor-cotizaciones" class="accion-item">
          <i class="icon-list"></i>
          <div>
            <h4>Mis Cotizaciones</h4>
            <p>Ver todas tus cotizaciones realizadas</p>
          </div>
          <i class="icon-arrow-right"></i>
        </a>
        
        <button class="accion-item logout" (click)="cerrarSesion()">
          <i class="icon-logout"></i>
          <div>
            <h4>Cerrar Sesión</h4>
            <p>Salir de tu cuenta de manera segura</p>
          </div>
          <i class="icon-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Errores -->
  <div *ngIf="!cargando && !usuario" class="error-container">
    <div class="error-icon">⚠️</div>
    <h3>No se pudo cargar el perfil</h3>
    <p>Ha ocurrido un error al cargar la información de tu perfil.</p>
    <button class="btn btn-primary" (click)="cargarPerfilUsuario()">
      Reintentar
    </button>
  </div>
</div>
